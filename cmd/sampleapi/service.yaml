# ===========================================
# Service Definition for sampleapi
# ===========================================
# This file defines deployment configuration for sampleapi.
# Infrastructure team manages the base setup, developers customize here.

name: sampleapi
description: "REST API service for the email platform"

# ===========================================
# Container Configuration
# ===========================================
container:
  port: 8080
  # CPU units (256 = 0.25 vCPU, 512 = 0.5 vCPU, 1024 = 1 vCPU)
  cpu: 256
  # Memory in MB
  memory: 512
  # Health check path
  health_check_path: /health
  # Health check command (optional, uses wget by default)
  # health_check_command: ["CMD-SHELL", "curl -f http://localhost:8080/health"]

# ===========================================
# Scaling Configuration
# ===========================================
scaling:
  # Desired number of tasks
  desired_count: 2
  # Minimum tasks (for autoscaling)
  min_count: 1
  # Maximum tasks (for autoscaling)
  max_count: 4
  # Enable autoscaling
  autoscaling_enabled: true
  # Target CPU utilization for scaling (%)
  cpu_target: 70
  # Target memory utilization for scaling (%) - optional
  # memory_target: 80

# ===========================================
# Load Balancer Configuration
# ===========================================
load_balancer:
  enabled: true
  # Priority for ALB listener rules (lower = higher priority)
  priority: 100
  # Path patterns to route to this service
  path_patterns:
    - "/api/*"
    - "/health"
  # Health check settings
  health_check:
    path: /health
    interval: 30
    timeout: 5
    healthy_threshold: 2
    unhealthy_threshold: 3

# ===========================================
# Environment Variables
# ===========================================
environment:
  PORT: "8080"
  LOG_LEVEL: "info"

# ===========================================
# Monitoring Configuration
# ===========================================
monitoring:
  # CloudWatch alarms
  alarms:
    # CPU alarm threshold (%)
    cpu_threshold: 80
    # Memory alarm threshold (%)
    memory_threshold: 80
    # Error rate threshold (errors per minute)
    error_rate_threshold: 10
  # Custom metrics to track
  metrics:
    - name: http_requests_total
      type: counter
    - name: http_request_duration_seconds
      type: histogram

# ===========================================
# Tags
# ===========================================
tags:
  team: platform
  component: api
  criticality: high

